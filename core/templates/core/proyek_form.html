{% extends 'core/base.html' %}

{% block content %}
<div class="container py-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>
            {% if form.instance.pk %}Edit Proyek: {{ form.instance.kode_proyek }}{% else %}Buat Proyek Baru{% endif %}
        </h2>
        <a href="{% url 'proyek-list' %}" class="btn btn-outline-secondary">Batal</a>
    </div>

    <form method="post" class="card shadow border-0">
        {% csrf_token %}
        <div class="card-body p-4">
            
            {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {{ form.non_field_errors }}
            </div>
            {% endif %}

            <!-- Informasi Utama -->
            <h5 class="text-primary border-bottom pb-2 mb-3">Informasi Umum</h5>
            <div class="mb-3">
                <label for="{{ form.nama_proyek.id_for_label }}" class="form-label fw-bold">Nama Proyek</label>
                {{ form.nama_proyek }}
                {{ form.nama_proyek.errors }}
            </div>
            
            <div class="row">
                <div class="col-md-8 mb-3">
                    <label for="{{ form.deskripsi.id_for_label }}" class="form-label">Deskripsi</label>
                    {{ form.deskripsi }}
                </div>
                <div class="col-md-4 mb-3">
                    <label for="{{ form.status.id_for_label }}" class="form-label fw-bold">Status Proyek</label>
                    {{ form.status }}
                    <div class="form-text text-muted">Ubah ke 'Selesai' hanya jika realisasi sudah 100%.</div>
                </div>
            </div>

            <!-- Bagian Tanggal: Plan vs Actual -->
            <div class="row mt-4">
                <!-- Kolom Kiri: PLAN -->
                <div class="col-md-6">
                    <div class="card h-100 bg-light border-0">
                        <div class="card-header bg-transparent border-0">
                            <h6 class="text-primary fw-bold mb-0"><i class="bi bi-calendar-event"></i> RENCANA (PLAN)</h6>
                            <small class="text-muted">Target jadwal awal.</small>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Tanggal Mulai (Plan)</label>
                                {{ form.tanggal_mulai }}
                                {{ form.tanggal_mulai.errors }}
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Tanggal Selesai (Plan)</label>
                                {{ form.tanggal_selesai }}
                                {{ form.tanggal_selesai.errors }}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Kolom Kanan: ACTUAL -->
                <div class="col-md-6 mt-3 mt-md-0">
                    <div class="card h-100" style="background-color: #f0fff4;">
                        <div class="card-header bg-transparent border-0">
                            <h6 class="text-success fw-bold mb-0"><i class="bi bi-check-circle"></i> REALISASI (ACTUAL)</h6>
                            <small class="text-muted">Diisi saat proyek berjalan/selesai.</small>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label">Mulai Aktual</label>
                                {{ form.tanggal_mulai_aktual }}
                                {{ form.tanggal_mulai_aktual.errors }}
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Selesai Aktual</label>
                                {{ form.tanggal_selesai_aktual }}
                                {{ form.tanggal_selesai_aktual.errors }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-4 text-end border-top pt-3">
                <button type="submit" class="btn btn-primary px-5 fw-bold">
                    <i class="bi bi-save"></i> SIMPAN PROYEK
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Script Kecil untuk UX -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Otomatis set tanggal aktual mulai = plan mulai (jika kosong) untuk mempercepat input
        const planStart = document.getElementById('id_tanggal_mulai');
        const actStart = document.getElementById('id_tanggal_mulai_aktual');
        
        if(planStart && actStart) {
            planStart.addEventListener('change', function() {
                if(!actStart.value) {
                    actStart.value = this.value;
                }
            });
        }
    });
</script>
{% endblock %}